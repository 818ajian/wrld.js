<!-- Create a map in an HTML element with eegeo.js -->
<!DOCTYPE HTML>
<html>
  <head>
    <script src="http://localhost:1337/dist/eegeo.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" rel="stylesheet" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="http://localhost:1337/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://localhost:1337/css/main.css" rel="stylesheet">

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="http://localhost:1337/js/bootstrap.min.js"></script>

    <!--<script src="http://localhost:1337/js/main.js"></script>-->
  </head>
  
  <body>

    <div id="content">

        <div id="map" style="height: 800px;"></div>
        
        <div id="shader-controls">
          <p id="shader-status" class="bg-primary">
            Shader Compile Status
          </p>

            <div id="createButton">
              <button type="button" class="btn btn-primary" onclick="doShader()">Create Shaders</button>
              <button type="button" class="btn btn-primary" onclick="applyBuildings()">Apply to Buildings</button>
              <button type="button" class="btn btn-primary" onclick="applyTerrain()">Apply to Terrain</button>
              <button type="button" class="btn btn-primary" onclick="applyTransport()">Apply to Transport</button>
              <input id="uniforms-list" type="text" class="form-control" placeholder="Shader Uniforms">
              <input id="samplers-list" type="text" class="form-control" placeholder="Shader Samplers">
            </div>
            
            <div id="vertex">
              <textarea id="vertex-code" class="form-control" rows="40" oninput="shaderChanged()">
//=======================================
attribute mediump vec4 Position;
attribute lowp vec2 UV;

uniform highp mat4 UnpackModelViewProjectionMatrix;

uniform highp vec2 MinUVRange;
uniform highp vec2 MaxUVRange;

uniform lowp mat4 LightColorMatrix;
uniform highp vec3 LightDotUnpack;
							 
//=======================================

varying lowp vec4 ColorVarying;
varying mediump vec2 DestinationUV;

void main(void) { 
	DestinationUV = mix(MinUVRange, MaxUVRange, UV);
	ColorVarying = LightColorMatrix * vec4(fract(Position.w * LightDotUnpack), 1.0);
	gl_Position = UnpackModelViewProjectionMatrix * vec4(Position.xyz, 1.0);
}
</textarea>
            </div>

            <div id="fragment">
              <textarea id="fragment-code" class="form-control" rows="40" oninput="shaderChanged()">
varying lowp vec4 ColorVarying;
varying mediump vec2 DestinationUV;

uniform sampler2D Diffuse;

void main(void) {
  vec3 tempColor = vec3(1.0, 0.0, 1.0);
  gl_FragColor.rgb = texture2D(Diffuse, DestinationUV).rgb * ColorVarying.rgb;
  gl_FragColor.rgb =  tempColor * ColorVarying.rgb;
}
</textarea>
            </div>

        </div>
        <!--<script src="http://localhost:1337/js/main.js"></script>-->
        
        <script>
        window.map = L.eeGeo.map("map", "9ce4509b3e6dc7ed2c936a6cfb89217e");

          function doShader() {
            var shaderStatus = document.getElementById("shader-status");

            shaderStatus.innerHTML = "Shader Compile Status";
            shaderStatus.className = "bg-primary";

            var vertexCode = document.getElementById("vertex-code").value;
            var fragCode = document.getElementById("fragment-code").value;
            var uniforms = document.getElementById("uniforms-list").value;
            var samplers = document.getElementById("samplers-list").value;

            window.map.createShaderPair(vertexCode, fragCode, uniforms, samplers);
          }

          function applyBuildings() {
            window.map.applyShadersToBuildings();
          }

          function applyTerrain() {
            window.map.applyShadersToTerrain();
          }

          function applyTransport() {
            window.map.applyShadersToTransport();
          }

          function shaderChanged() {
            var shaderStatus = document.getElementById("shader-status");

            if (shaderStatus.className == "bg-success") {
              shaderStatus.innerHTML = "Shader Compile Status";
              shaderStatus.className = "bg-primary";
            }
          }
        </script>
    </div>
  </body>
</html>
